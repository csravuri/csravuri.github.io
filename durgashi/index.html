<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravuri Wedding Invitation | Durga Sai &amp; Ashiervachita</title>
    <meta name="description" content="Ravuri's Wedding Invitation â€” Durga Sai & Ashiervachita. Wedding and reception details with maps and gallery.">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page">
        <header class="top-section" aria-label="Invitation header">
            <canvas id="star-canvas" aria-hidden="true"></canvas>
            <div class="hero-inner">
                <h1 id="heroTitle">Ravuri's Wedding Invitation</h1>
                <div class="hero-subtitle">With the blessings of our families</div>
            </div>
        </header>

        <img src="imgs/banana-tree.png" class="banana-tree left" alt="" aria-hidden="true" loading="lazy">
        <img src="imgs/banana-tree.png" class="banana-tree right" alt="" aria-hidden="true" loading="lazy">

        <main class="invitation-container" id="content">
            <section class="names-card" aria-label="Couple">
                <div class="overline">Groom &amp; Bride</div>
                <div class="names" id="names">Durga Sai <span class="amp">&amp;</span> Ashiervachita</div>
                <div class="family-line" id="familyLine">Family name: Ravuri</div>
            </section>

            <section class="events" aria-label="Events" id="events">
                <article class="event">
                    <h2>Wedding</h2>
                    <div class="event-row">
                        <span class="label">Date</span>
                        <span class="value">11 March 2026, 11:06pm</span>
                    </div>
                    <div class="event-row">
                        <span class="label">Venue</span>
                        <span class="value">TTD Function Hall, Tirumala, Tirupati, Andhra Pradesh, India.</span>
                    </div>
                    <div class="event-actions">
                        <a class="btn btn-primary" href="mailto:?subject=RSVP%20-%20Ravuri%20Wedding%20(Wedding)&body=Couple%3A%20Durga%20Sai%20%26%20Ashiervachita%0AEvent%3A%20Wedding%0A%0AName%3A%0AAttending%3A%20Yes%20%2F%20No%0AGuests%3A%0A%0AMessage%3A">RSVP</a>
                        <a class="btn btn-ghost" href="https://www.google.com/maps/search/?api=1&query=TTD%20Function%20Hall%2C%20Tirumala%2C%20Tirupati%2C%20Andhra%20Pradesh%2C%20India" target="_blank" rel="noopener noreferrer">Google Map</a>
                    </div>
                </article>

                <article class="event">
                    <h2>Reception</h2>
                    <div class="event-row">
                        <span class="label">Date</span>
                        <span class="value">14 March 2026, 10am</span>
                    </div>
                    <div class="event-row">
                        <span class="label">Venue</span>
                        <span class="value">Sajja Function Hall, GBC Road, Ponnur, Guntur, Andhra Pradesh, India.</span>
                    </div>
                    <div class="event-actions">
                        <a class="btn btn-primary" href="mailto:?subject=RSVP%20-%20Ravuri%20Wedding%20(Reception)&body=Couple%3A%20Durga%20Sai%20%26%20Ashiervachita%0AEvent%3A%20Reception%0A%0AName%3A%0AAttending%3A%20Yes%20%2F%20No%0AGuests%3A%0A%0AMessage%3A">RSVP</a>
                        <a class="btn btn-ghost" href="https://www.google.com/maps/search/?api=1&query=Sajja%20Function%20Hall%2C%20GBC%20Road%2C%20Ponnur%2C%20Guntur%2C%20Andhra%20Pradesh%2C%20India" target="_blank" rel="noopener noreferrer">Google Map</a>
                    </div>
                </article>

                <article class="event">
                    <h2>Home Address</h2>
                    <div class="event-row">
                        <span class="label">Address</span>
                        <span class="value">Near Japrada Apartment, Canal Road, Gajulapalem, Ponnur, Guntur, Andhra Pradesh, India.</span>
                    </div>
                    <div class="event-actions">
                        <a class="btn btn-ghost" href="https://www.google.com/maps/search/?api=1&query=Near%20Japrada%20Apartment%2C%20Canal%20Road%2C%20Gajulapalem%2C%20Ponnur%2C%20Guntur%2C%20Andhra%20Pradesh%2C%20India" target="_blank" rel="noopener noreferrer">Google Map</a>
                    </div>
                </article>
            </section>
        </main>

        <section class="gallery-container" aria-label="Gallery">
            <div class="gallery-header">
                <h2>Gallery</h2>
                <div class="gallery-hint">Swipe / scroll</div>
            </div>
            <div class="gallery-strip" id="galleryStrip">
                <img src="../img/portfolio-1.jpg" alt="Gallery photo 1" loading="lazy">
                <img src="../img/portfolio-2.jpg" alt="Gallery photo 2" loading="lazy">
                <img src="../img/portfolio-3.jpg" alt="Gallery photo 3" loading="lazy">
                <img src="../img/portfolio-4.jpg" alt="Gallery photo 4" loading="lazy">
                <img src="../img/portfolio-5.jpg" alt="Gallery photo 5" loading="lazy">
                <img src="../img/portfolio-6.jpg" alt="Gallery photo 6" loading="lazy">
            </div>
        </section>

        <footer class="footer">
            <div class="hashtag">#durgashi</div>
        </footer>
    </div>

    <script type="module">
        const $ = (sel, root = document) => root.querySelector(sel);

        function extractSection(text, tag) {
            const re = new RegExp(`<${tag}>\\s*([\\s\\S]*?)\\s*</${tag}>`, 'i');
            const match = text.match(re);
            return match ? match[1].trim() : '';
        }

        function normalizeSpaces(s) {
            return s.replace(/\s+/g, ' ').trim();
        }

        function parseBaseData(sectionText) {
            const lines = sectionText
                .split(/\r?\n/)
                .map(l => l.trim())
                .filter(Boolean);

            const data = { groom: '', bride: '', familyName: '', events: [] };
            let currentEvent = null;

            const startEvent = (name) => {
                currentEvent = { name: normalizeSpaces(name), date: '', venue: '' };
                data.events.push(currentEvent);
            };

            for (const raw of lines) {
                const line = normalizeSpaces(raw);
                const kv = line.match(/^([^:]+):\s*(.*)$/);

                if (kv) {
                    const key = normalizeSpaces(kv[1]);
                    const value = normalizeSpaces(kv[2] ?? '');
                    const lowerKey = key.toLowerCase();

                    if (lowerKey === 'groom') data.groom = value;
                    else if (lowerKey === 'bride') data.bride = value;
                    else if (lowerKey === 'family name') data.familyName = value;
                    else if (value === '') startEvent(key);
                    else if (currentEvent) {
                        if (lowerKey === 'date') currentEvent.date = value;
                        else if (lowerKey === 'venue') currentEvent.venue = value;
                        else if (!currentEvent.venue) currentEvent.venue = line;
                    }
                } else if (currentEvent) {
                    if (!currentEvent.venue) currentEvent.venue = line;
                    else currentEvent.venue = normalizeSpaces(`${currentEvent.venue} ${line}`);
                }
            }

            return data;
        }

        function mapsUrl(query) {
            const q = encodeURIComponent(query);
            return `https://www.google.com/maps/search/?api=1&query=${q}`;
        }

        function mailtoRsvp({ familyName, couple, eventName }) {
            const subject = `RSVP - ${familyName} Wedding (${eventName})`;
            const body = [
                `Couple: ${couple}`,
                `Event: ${eventName}`,
                ``,
                `Name:`,
                `Attending: Yes / No`,
                `Guests:`,
                ``,
                `Message:`,
            ].join('\n');

            return `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function render(data) {
            const couple = `${data.groom || 'Groom'} & ${data.bride || 'Bride'}`;
            const familyName = data.familyName || 'Ravuri';

            $('#heroTitle').textContent = `${familyName}'s Wedding Invitation`;
            $('#names').innerHTML = `${data.groom || 'Durga Sai'} <span class="amp">&amp;</span> ${data.bride || 'Ashiervachita'}`;
            $('#familyLine').textContent = `Family name: ${familyName}`;

            const eventsEl = $('#events');
            eventsEl.innerHTML = '';

            for (const ev of data.events) {
                const card = document.createElement('article');
                card.className = 'event';

                const title = document.createElement('h2');
                title.textContent = ev.name;

                const dateRow = document.createElement('div');
                dateRow.className = 'event-row';
                dateRow.innerHTML = `<span class="label">Date</span><span class="value">${ev.date}</span>`;

                const venueText = (ev.venue || '').replace('Appratment', 'Apartment');
                const venueRow = document.createElement('div');
                venueRow.className = 'event-row';
                venueRow.innerHTML = `<span class="label">${ev.name.toLowerCase().includes('home') ? 'Address' : 'Venue'}</span><span class="value">${venueText}</span>`;

                const actions = document.createElement('div');
                actions.className = 'event-actions';

                const rsvp = document.createElement('a');
                rsvp.className = 'btn btn-primary';
                rsvp.href = mailtoRsvp({ familyName, couple, eventName: ev.name });
                rsvp.textContent = 'RSVP';

                const map = document.createElement('a');
                map.className = 'btn btn-ghost';
                map.href = mapsUrl(venueText || ev.name);
                map.target = '_blank';
                map.rel = 'noopener noreferrer';
                map.textContent = 'Google Map';

                actions.appendChild(rsvp);
                actions.appendChild(map);

                card.appendChild(title);
                if (ev.date) card.appendChild(dateRow);
                if (venueText) card.appendChild(venueRow);
                card.appendChild(actions);

                eventsEl.appendChild(card);
            }
        }

        async function initData() {
            try {
                const res = await fetch('./data.md', { cache: 'no-store' });
                if (!res.ok) throw new Error(`Failed to load data.md (${res.status})`);
                const md = await res.text();
                const base = extractSection(md, 'BaseData');
                if (!base) throw new Error('BaseData section not found in data.md');
                render(parseBaseData(base));
            } catch (err) {
                console.warn(err);
                const note = document.createElement('div');
                note.className = 'load-error';
                note.textContent = 'Could not load data.md. Showing fallback content.';
                $('#content').appendChild(note);
            }
        }

        function initStars() {
            const canvas = /** @type {HTMLCanvasElement} */ ($('#star-canvas'));
            const ctx = canvas.getContext('2d');
            const topSection = $('.top-section');

            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (prefersReducedMotion) return;

            const stars = [];
            const numStars = 110;

            function resizeCanvas() {
                const dpr = Math.min(window.devicePixelRatio || 1, 2);
                const rect = topSection.getBoundingClientRect();

                canvas.style.width = `${rect.width}px`;
                canvas.style.height = `${rect.height}px`;
                canvas.width = Math.floor(rect.width * dpr);
                canvas.height = Math.floor(rect.height * dpr);
                ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

                stars.length = 0;
                for (let i = 0; i < numStars; i++) {
                    stars.push({
                        x: Math.random() * rect.width,
                        y: Math.random() * rect.height,
                        radius: 0.7 + Math.random() * 1.4,
                        alpha: 0.25 + Math.random() * 0.75,
                        speed: (Math.random() * 0.22 + 0.05) * (Math.random() < 0.5 ? -1 : 1),
                    });
                }
            }

            function tick() {
                const rect = topSection.getBoundingClientRect();
                ctx.clearRect(0, 0, rect.width, rect.height);
                for (const s of stars) {
                    s.alpha += s.speed;
                    if (s.alpha > 1) { s.alpha = 1; s.speed *= -1; }
                    if (s.alpha < 0.15) { s.alpha = 0.15; s.speed *= -1; }

                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${s.alpha})`;
                    ctx.fill();
                }
                requestAnimationFrame(tick);
            }

            resizeCanvas();
            tick();
            window.addEventListener('resize', resizeCanvas, { passive: true });
        }

        initStars();
        initData();
    </script>
</body>
</html>
